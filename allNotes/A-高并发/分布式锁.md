# 分布式锁

>加锁肯定会影响到吞吐量的；
>
>加事务，肯定也会到影响到吞吐量和也有可能导致死锁的问题；
>
>其实事务的隔离性就是锁来实现的；
>
>当前读肯定要去最新的数据，不然可能会导致数据的丢失；
>
>事务的隔离性就是用 	事务之间的可见性，就是用mvcc 和锁来实现的；



## php 不需要考虑内存安全的原因



php 是多进程的，每一个请求都是一个进程；所以肯定是内存安全的呀；

php 本身是多进程的，当处理完一个请求会销毁所有的变量然后直到下一个请求；

所以本身不存在一个 内存安全的问题；

所有的内存都是一个进程来处理，所有的变量只有一个请求来处理；





## 但是当处于分布式服务器的时候为什么会考虑分布式锁的问题呢 ？



分布式服务器就是负载均衡？？？



因为多个服务器，同时去修改mysql的一个库存，那么肯定会出现一个就需要分布式锁来保证原子性？？？



其实 还是并发量还不高的原因把？  是的；并发量不高的原因；



分布式锁 到底是个什么东西？？

为什么要枷锁？

卧槽了

## 分布式锁

分布式 这个名字其实就是代表并发量很大的缘故，只有并发量比较大才会使用分布式，所以分布式就代表并发量肯定是很大的；



多线程的时候当然也会有缺点： 关于线程安全的问题；这个锁是语言内部的锁；



**分布式锁 代表的其实就是  很多的服务器共同去访问一个共享资源；并不是在同一个进程内的共享资源；因为是不同的系统不在一个服务器那么你使用语言内部的锁肯定是实现不了的，那么只能使用分布式锁； 来保证安全性；**

**肯定是需要去锁住共享资源，让资源只有进程进行操作，来保证数据的一致性；**

**但是这个共享资源，不是php内部的共享资源，而是php外部的共享资源，比如mysql的某个库存字段，或者是redis 的某个key；**



比如 很多个服务器去共同访问一个共享资源；不同的进程去访问共享资源，就像php 很多进程去修改redis的某个key那么就会存在分布式锁的问题，当然当并发量很小的话，就不会存在共享资源安全的问题；这个差不多就是分布式锁的应用；



## 分布式事务

>**事务仅仅是保证，一个库的一致性；**
>
>**但是当你需要考虑，跨库来保证数据的一致性，就需要考虑分布式事务了；**

例如 两个银行的转账就是需要保证两个系统的一致性；

那么就需要用分布式锁；来保证；

一般需要一个第三方 来保证两个一起提交； 一般会有不同的插件；---   



大体流程，用一个中间件来协调这两个事务，必须两个都提交的时候才会一起提交，有一个失败那么就要进行回滚；

update  set money=money-100 where bankid=1;

update set money=money+100 where bankid=2;









