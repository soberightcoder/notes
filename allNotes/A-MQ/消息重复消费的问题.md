# 队列---重复消费问题





很多消息队列比如 kafka,MQ都会出现重复消费的问题，正常；



**因为这些问题通常不是mq自己来保证的，是需要自己来保证的，就是来保证自己系统的幂等性**；



## 为什么会发生重复消费  （其实还是幂等性的问题；）

消费者重启之后，就会存在于一个重复消费的问题；

```````php
# create order----- mysql ------ offset 152 
# 重启------
# commit offset 152 

#其实就是消费了  152的数据，本来要commit的但是重启了，消息队列是认为消费者消费失败的；所以消费者上线之后，还会发152这条消息；
#如果你们系统不是幂等性的，所以就会出现两条重复的消息；
#
```````





## 如何保证幂等性



**判断是否已经消费过了；**



**这边直接使用 redis set 直接来去重就可以了；**  



**一般是登录的，完全可以用user_id防止来重复消费的问题；**



`````php
`````

